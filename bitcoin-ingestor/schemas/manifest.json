{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Data File Manifest",
  "description": "Schema for manifest files describing uploaded data chunks",
  "type": "object",
  "required": [
    "version",
    "source",
    "payload",
    "created_at_ms"
  ],
  "properties": {
    "version": {
      "type": "string",
      "description": "Manifest schema version",
      "const": "1"
    },
    "source": {
      "type": "object",
      "description": "Information about data source",
      "required": [
        "exchange",
        "stream",
        "symbol",
        "instance_id"
      ],
      "properties": {
        "exchange": {
          "type": "string",
          "description": "Exchange name",
          "examples": ["binance"]
        },
        "stream": {
          "type": "string",
          "description": "Stream type",
          "examples": ["trade", "kline"]
        },
        "symbol": {
          "type": "string",
          "description": "Trading symbol",
          "examples": ["BTCUSDT", "ETHUSDT"]
        },
        "instance_id": {
          "type": "string",
          "description": "Collector instance identifier",
          "examples": ["i-0abc12345", "local-001"]
        }
      }
    },
    "payload": {
      "type": "object",
      "description": "Metadata about the data file",
      "required": [
        "s3_key",
        "record_count",
        "bytes_uncompressed",
        "bytes_gzip",
        "time_min_ms",
        "time_max_ms",
        "sha256"
      ],
      "properties": {
        "s3_key": {
          "type": "string",
          "description": "S3 key of the data file"
        },
        "record_count": {
          "type": "integer",
          "description": "Number of records in the file",
          "minimum": 0
        },
        "bytes_uncompressed": {
          "type": "integer",
          "description": "Uncompressed file size in bytes",
          "minimum": 0
        },
        "bytes_gzip": {
          "type": "integer",
          "description": "Compressed (gzip) file size in bytes",
          "minimum": 0
        },
        "time_min_ms": {
          "type": "integer",
          "description": "Minimum timestamp in the file (milliseconds)"
        },
        "time_max_ms": {
          "type": "integer",
          "description": "Maximum timestamp in the file (milliseconds)"
        },
        "id_first": {
          "type": "integer",
          "description": "First trade/event ID in the file"
        },
        "id_last": {
          "type": "integer",
          "description": "Last trade/event ID in the file"
        },
        "sha256": {
          "type": "string",
          "description": "SHA256 hash of the compressed file",
          "pattern": "^[a-f0-9]{64}$"
        }
      }
    },
    "created_at_ms": {
      "type": "integer",
      "description": "Manifest creation timestamp (milliseconds)"
    }
  },
  "examples": [
    {
      "version": "1",
      "source": {
        "exchange": "binance",
        "stream": "trade",
        "symbol": "BTCUSDT",
        "instance_id": "i-0abc12345"
      },
      "payload": {
        "s3_key": "raw/exchange=binance/stream=trade/symbol=BTCUSDT/dt=2025-01-01/12/34/part-i-0abc12345-1735738440567.jsonl.gz",
        "record_count": 12873,
        "bytes_uncompressed": 3689452,
        "bytes_gzip": 2048123,
        "time_min_ms": 1735738430123,
        "time_max_ms": 1735738440560,
        "id_first": 1234567890,
        "id_last": 1234580762,
        "sha256": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
      },
      "created_at_ms": 1735738440570
    }
  ]
}
